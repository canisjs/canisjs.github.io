!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("anichart",[],e):"object"==typeof exports?exports.anichart=e():t.anichart=e()}(window,function(){return function(t){var e={};function a(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=t,a.c=e,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(r,n,function(e){return t[e]}.bind(null,n));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=4)}([function(t,e,a){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._offset=0,this._reference=t.timingRef.previousStart}var e,a,i;return e=t,i=[{key:"transRef",value:function(t){switch(console.log(this.timingRef),t){case this.timingRef.previousStart:return"previousStart";case this.timingRef.previousEnd:return"previousEnd";case this.timingRef.absolute:return"absolute"}}}],(a=[{key:"calOffsetTime",value:function(e,a){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map;if(0===i.size){var o=0;switch(this.reference){case t.timingRef.previousStart:o=e+this.offset-n;break;case t.timingRef.previousEnd:o=a+this.offset-n;break;case t.timingRef.absolute:o=this.offset+n;break;default:o=e+this.offset-n}return o}var s=this,u=new Map,l=1e6;return"object"===r(this.offset)&&i.forEach(function(t,e){l>parseFloat(t["data-datum"][s.offset.field])&&(l=parseFloat(t["data-datum"][s.offset.field]))}),i.forEach(function(i,o){var c=0;switch(c="number"==typeof s.offset?s.offset:"object"===r(s.offset)?s.offset.minOffset*parseFloat(i["data-datum"][s.offset.field])/l:0,s.reference){case t.timingRef.previousStart:u.set(o,e+c-n);break;case t.timingRef.previousEnd:u.set(o,a+c-n);break;case t.timingRef.absolute:u.set(o,c+n);break;default:u.set(o,e+c-n)}}),u}},{key:"reference",set:function(e){if(void 0!==e){console.log("offset ref: ",e);var a=t.transRef(e);console.log(a),Object.keys(t.timingRef).includes(a)?this._reference=e:alert("the 'reference' of TimingSpec has to be one of 'previousStart', 'previousEnd' or 'absolute'. ")}},get:function(){return this._reference}},{key:"offset",set:function(e){void 0!==e&&("number"==typeof e?this._offset=Math.floor(e/(1e3/t.FRAME_RATE))*(1e3/t.FRAME_RATE):"object"===r(e)&&(this._offset=e))},get:function(){return this._offset}}])&&n(e.prototype,a),i&&n(e,i),t}();i.FRAME_RATE=25,i.timingRef={previousStart:"start with previous",previousEnd:"start after previous",absolute:"absolute"};var o=i;e.default=o,t.exports=e.default},function(t,e,a){"use strict";function r(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a,o;return e=t,o=[{key:"deepClone",value:function(e){if(!e||1==e)return e;var a=n(e);if("number"==a||"string"==a)return e;var r=Array.isArray(e)?[]:{};if(e instanceof Map){r=new Map;for(var i=0;i<e.keys().length;i++){var o=e.keys()[i];r.set(o,t.deepClone(e.get(o)))}}for(var s in e)e.hasOwnProperty(s)&&(r[s]=t.deepClone(e[s]));return r}},{key:"formatTime",value:function(t){var e=parseInt(t/1e3),a=parseInt(t%1e3/10);return(e<10?"0"+e:""+e)+":"+(a<10?"0"+a:""+a)}},{key:"color2RGB",value:function(e){if((e=e.replace(/\s/g,"")).indexOf("rgb")>=0){var a=e.substr(e.indexOf("(")+1),r=(a=a.substring(0,a.indexOf(")"))).split(",");return[parseInt(r[0]),parseInt(r[1]),parseInt(r[2])]}if(e.indexOf("#")>=0)return t.HEX2RGB(e)}},{key:"HEX2RGB",value:function(t){if("#"===t.charAt(0)&&(t=t.substr(1)),t.length<2||t.length>6)return!1;var e,a,r,n=t.split("");if(2===t.length)a=e=parseInt(n[0].toString()+n[1].toString(),16),r=e;else if(3===t.length)e=parseInt(n[0].toString()+n[0].toString(),16),a=parseInt(n[1].toString()+n[1].toString(),16),r=parseInt(n[2].toString()+n[2].toString(),16);else{if(6!==t.length)return!1;e=parseInt(n[0].toString()+n[1].toString(),16),a=parseInt(n[2].toString()+n[3].toString(),16),r=parseInt(n[4].toString()+n[5].toString(),16)}return[e,a,r]}},{key:"toJSON",value:function(t){var e={nodeType:(t=t||this).nodeType};t.tagName?e.tagName=t.tagName.toLowerCase():t.nodeName&&(e.nodeName=t.nodeName),t.nodeValue&&(e.nodeValue=t.nodeValue);var a=t.attributes;if(a){e.attr={};for(var r,n=0;n<a.length|(r=a[n]);n++)e.attr[r.nodeName]=r.nodeValue}return e}},{key:"toDOM",value:function(t){var e;switch("string"==typeof t&&(t=JSON.parse(t)),t.nodeType){case 1:e=document.createElementNS("http://www.w3.org/2000/svg",t.tagName);for(var a,r=t.attr||{},i=0;i<Object.keys(r).length|(a=Object.keys(r)[i]);i++){var o="object"===n(r[a])?JSON.stringify(r[a],null,0):r[a];e.setAttributeNS(null,a,o)}break;case 3:e=document.createTextNode(t.nodeValue);break;case 8:e=document.createComment(t.nodeValue);break;case 9:e=document.implementation.createDocument();break;case 10:e=document.implementation.createDocumentType(t.nodeName);break;case 11:e=document.createDocumentFragment();break;default:return e}return e}},{key:"discretizePath",value:function(e){if("path"!==e.tagName)return null;var a=e.attr||{};return a.d?t.discretizeD(a.d,a.fill):null}},{key:"discretizeD",value:function(e,a){for(var r=[],n=/[MmLlHhVvZzCcSsQqTtAa][^MmLlHhVvZzCcSsQqTtAa]*/gi,i=void 0;i=n.exec(e);){var o=r.reduce(function(t,e){return t+e.length},0);r.push(e.slice(o,i.index)),r.push(i[0])}var s=r.map(function(t){var e=t.slice(0,1),a=t.slice(1).split(/[ ,]/).filter(function(t){return t.trim()}).map(function(t){return parseFloat(t)});return e?{command:e,parameters:a}:null}).filter(function(t){return t});if(s.every(function(t){return"MmLlHhVv".includes(t.command)})&&!t.convertColor(a)){var u=[],l=null,c=!0;if(s.forEach(function(t){if(c)if("M"!==t.command){if(!l)return c=!1;if("m"!==t.command){var e=l,a=t.command===t.command.toLowerCase()?l.slice():[0,0];switch(t.command.toLowerCase()){case"l":a=a.map(function(e,a){return e+t.parameters[a]});break;case"h":a[0]+=t.parameters[0],a[1]=e[1];break;case"v":a[1]+=t.parameters[0],a[0]=e[0]}a?(u.push([e,a]),l=a):c=!1}else l=l.map(function(e,a){return e+t.parameters[a]})}else l=t.parameters.slice(-2)}),c)return{type:"lines",data:u}}if(s.every(function(t){return"MmLlAaZz".includes(t.command)})&&s.filter(function(t){return"a"===t.command.toLowerCase()}).length){var f=[],d=null,g=!0;if(s.forEach(function(e){if(g)if("M"!==e.command){if(!d)return g=!1;if("z"!==e.command.toLowerCase()){var a=d,r=e.command.toLowerCase()===e.command?d.slice():[0,0];if("a"!==e.command.toLowerCase())return d=r.map(function(t,a){return t+e.parameters[a]});r=r.map(function(t,a){return t+e.parameters[a+5]}),f.push({...t.svgArcToCenterParam.apply(null,a.concat(e.parameters.slice(0,5)).concat(r)),rx:e.parameters[0],ry:e.parameters[1],rotate:e.parameters[2]}),d=r}}else d=e.parameters.slice(-2)}),(f.length<=0||!f.every(function(t){return["cx","cy"].reduce(function(e,a){return e+Math.abs(t[a]-f[0][a])},0)<.001}))&&(g=!1),g){var m=f.reduce(function(t,e){return t?e.rx+e.ry>t.rx+t.ry?e:t:e},null);return{type:"pies",data:{cx:m.cx,cy:m.cy,startAngle:m.startAngle,endAngle:m.endAngle,radius:f.map(function(t){return{rx:t.rx,ry:t.ry,rotate:t.rotate}})}}}}return null}},{key:"radian",value:function(t,e,a,r){var n=t*a+e*r,i=Math.sqrt((t*t+e*e)*(a*a+r*r)),o=Math.acos(n/i);return t*r-e*a<0&&(o=-o),o}},{key:"svgArcToCenterParam",value:function(e,a,r,n,i,o,s,u,l){var c,f,d,g,m,h=2*Math.PI;if(r<0&&(r=-r),n<0&&(n=-n),0==r||0==n)throw Error("rx and ry can not be 0");var p=Math.sin(i),b=Math.cos(i),y=(e-u)/2,v=(a-l)/2,A=(e+u)/2,k=(a+l)/2,T=b*y+p*v,w=b*v-p*y,S=T*T/(r*r)+w*w/(n*n);S>1&&(r*=Math.sqrt(S),n*=Math.sqrt(S));var x=r*n,N=r*w,M=n*T,E=N*N+M*M;if(!E)throw Error("start point can not be same as end point");var F=Math.sqrt(Math.abs((x*x-E)/E));o==s&&(F=-F);var I=F*N/n,O=-F*M/r;c=b*I-p*O+A,f=p*I+b*O+k;var C=(T-I)/r,R=(T+I)/r,_=(w-O)/n,B=(w+O)/n;for(d=t.radian(1,0,C,_),g=t.radian(C,_,-R,-B);g>h;)g-=h;for(;g<0;)g+=h;for(0!=s&&0!=s||(g-=h),m=d+g;m>h;)m-=h;for(;m<0;)m+=h;return{cx:c,cy:f,startAngle:d,deltaAngle:g,endAngle:m,clockwise:1==s||1==s}}},{key:"convertColor",value:function(t,e,a){if("string"!=typeof t)return t;if("none"===t)return null;t=t.trim();var r=null;switch(void 0===a&&(a=e,t.startsWith("#")?e="hex":t.startsWith("rgb")&&(e="rgb")),e){case"rgb":r=t.split("(")[1].split(",").map(function(t){return parseFloat(t)});break;case"hex":r=t.slice(1).match(/.{1,2}/g).map(function(t){return parseInt(t,16)});default:return t}switch(r=r.slice(0,3),a){case"hex":return"#"+r.map(function(t){return t.toString(16).padStart(2,"0")}).join("");case"rgb":return"rgb(".concat(r.join(","),")");default:return t}}},{key:"polarToCartesian",value:function(t,e,a,r){return{x:Math.round(100*(t+a*Math.cos(r)))/100,y:Math.round(100*(e+a*Math.sin(r)))/100}}},{key:"arc",value:function(e,a,r,n,i,o){i=i<0?i+2*Math.PI:i,r=0===r?0:r-1,n+=1;var s=(o=o<0||i>o?o+2*Math.PI:o)-i<=Math.PI?0:1,u=t.polarToCartesian(e,a,n,o),l=t.polarToCartesian(e,a,n,i),c=t.polarToCartesian(e,a,r,o),f=t.polarToCartesian(e,a,r,i),d=!1;return u.x===l.x&&u.y===l.y&&(l.y-=1,f.y-=1,d=!0),d?["M"+u.x,u.y,"A"+n,n,0,s,1,l.x,l.y,"M"+f.x,f.y,"A"+r,r,0,s,0,c.x,c.y+"Z"].join(","):["M"+u.x,u.y,"A"+n,n,0,s,0,l.x,l.y,"L"+f.x,f.y,"A"+r,r,0,s,1,c.x,c.y,"L"+u.x,u.y+"Z"].join(",")}},{key:"domNodeToString",value:function(t){var e=document.createElement("div");return e.appendChild(t),e.innerHTML}},{key:"strToDomNode",value:function(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}},{key:"transShape",value:function(e,a,r){if("path"!==e.tagName)(e.getAttribute("x")||e.getAttribute("y"))&&(e.setAttribute("x",e.getAttribute("x")?parseFloat(e.getAttribute("x"))+a:a),e.setAttribute("y",e.getAttribute("y")?parseFloat(e.getAttribute("y"))+r:r)),(e.getAttribute("x1")||e.getAttribute("y1")||e.getAttribute("x2")||e.getAttribute("y2"))&&(e.setAttribute("x1",e.getAttribute("x1")?parseFloat(e.getAttribute("x1"))+a:a),e.setAttribute("x2",e.getAttribute("x2")?parseFloat(e.getAttribute("x2"))+a:a),e.setAttribute("y1",e.getAttribute("y1")?parseFloat(e.getAttribute("y1"))+r:r),e.setAttribute("y2",e.getAttribute("y2")?parseFloat(e.getAttribute("y2"))+r:r)),(e.getAttribute("cx")||e.getAttribute("cy"))&&(e.setAttribute("cx",e.getAttribute("cx")?parseFloat(e.getAttribute("cx"))+a:a),e.setAttribute("cy",e.getAttribute("cy")?parseFloat(e.getAttribute("cy"))+r:r));else if(e.getAttribute("d")){var n=t.setPathDValue(e.getAttribute("d"),!1,a,r);e.setAttribute("d",n)}}},{key:"setPathDValue",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Map;t=(t=t.toLowerCase()).replace(/(?<=\d)\s(?=[mlhvcsqtaz])/g,"").replace(/(?<=[mlhvcsqta])\s(?=(\d|[-+]))/g,"").replace(/\s/g,",");var i=new RegExp(/[mlhvcsqta][^mlhvcsqtaz]*/g),o="",s=t.match(i);if(s){for(var u=0;u<s.length;u++){var l=s[u].substring(0,1),c=s[u].substring(1);switch(o+=l.toUpperCase(),l){case"h":if(e)if(void 0!==n.get(l)){for(var f=n.get(l),d=!1,g=0;g<f.length;g++)if(f[g].cmdIdx===u){o+="0",d=!0;break}d||(o+=c)}else o+=c;else o+=parseFloat(c)+a;break;case"v":if(e)if(void 0!==n.get(l)){for(var m=n.get(l),h=!1,p=0;p<m.length;p++)if(m[p].cmdIdx===u){o+="0",h=!0;break}h||(o+=c)}else o+=c;else o+=parseFloat(c)+r;break;case"m":case"l":case"c":case"s":case"q":case"t":for(var b=c.split(","),y=0;y<b.length;y++){if(y%2==0)if(e)if(void 0!==n.get(l)){for(var v=n.get(l),A=!1,k=0;k<v.length;k++)if(v[k].cmdIdx===u&&v[k].diffAttrIdxs.indexOf(y)>=0){o+="0",A=!0;break}A||(o+=b[y])}else o+=b[y];else o+=parseFloat(b[y])+a;else if(e)if(void 0!==n.get(l)){for(var T=n.get(l),w=!1,S=0;S<T.length;S++)if(T[S].cmdIdx===u&&T[S].diffAttrIdxs.indexOf(y)>=0){o+="0",w=!0;break}w||(o+=b[y])}else o+=b[y];else o+=parseFloat(b[y])+r;y!==b.length-1&&(o+=",")}break;case"a":for(var x=c.split(","),N=0;N<x.length;N++)if(N===x.length-2)if(e)if(void 0!==n.get(l)){for(var M=n.get(l),E=!1,F=0;F<M.length;F++)if(M[F].cmdIdx===u&&M[F].diffAttrIdxs.indexOf(N)>=0){o+="1,",E=!0;break}E||(o+=x[N]+",")}else o+=x[N]+",";else o+=parseFloat(x[N])+a+",";else if(N===x.length-1)if(e)if(void 0!==n.get(l)){for(var I=n.get(l),O=!1,C=0;C<I.length;C++)if(I[C].cmdIdx===u&&I[C].diffAttrIdxs.indexOf(N)>=0){o+="1",O=!0;break}O||(o+=x[N])}else o+=x[N];else o+=parseFloat(x[N])+r;else o+=x[N]+","}}"z"===t.charAt(t.length-1)&&(o+="Z")}return o}},{key:"calTransD",value:function(e,a,r){e=(e=e.toLowerCase()).replace(/(?<=\d)\s(?=[mlhvcsqtaz])/g,"").replace(/(?<=[mlhvcsqta])\s(?=(\d|[-+]))/g,"").replace(/\s/g,","),a=(a=a.toLowerCase()).replace(/(?<=\d)\s(?=[mlhvcsqtaz])/g,"").replace(/(?<=[mlhvcsqta])\s(?=(\d|[-+]))/g,"").replace(/\s/g,",");var n=new RegExp(/[mlhvcsqta][^mlhvcsqtaz]*/g),i="",o=e.match(n),s=a.match(n);if(o){for(var u=!1,l=!1,c=["c","s","q","t"],f=0;f<o.length;f++){var d=o[f].substring(0,1);c.indexOf(d)>=0?u=!0:"a"===d&&(l=!0)}if(u);else if(l){for(var g=t.discretizeD(e.toUpperCase()),m=t.discretizeD(a.toUpperCase()),h=Object.keys(g.data),p=(Object.keys(m.data),["cx","cy","radius","startAngle","endAngle"]),b={},y=0;y<h.length;y++){var v=h[y];if(p.indexOf(v)>=0)if(JSON.stringify(g.data[v])!==JSON.stringify(m.data[v]))if("radius"===v)g.data[v].length>1?(b.innerRadius=(m.data[v][0].rx-g.data[v][0].rx)*r+g.data[v][0].rx+1,b.outterRadius=(m.data[v][1].rx-g.data[v][1].rx)*r+g.data[v][1].rx-1):(b.innerRadius=0,b.outterRadius=(m.data[v][0].rx-g.data[v][0].rx)*r+g.data[v][0].rx-1);else if("startAngle"===v||"endAngle"===v){var A=g.data.startAngle,k=g.data.endAngle,T=m.data.startAngle,w=m.data.endAngle,S=t.arcTransition(A,k,T,w,r);b.startAngle=S[0],b.endAngle=S[1]}else b[v]=(m.data[v]-g.data[v])*r+g.data[v];else"radius"===v?(b.innerRadius=0,b.outterRadius=m.data[v][0].rx-1):b[v]=m.data[v]}i=t.arc(b.cx,b.cx,b.innerRadius,b.outterRadius,b.startAngle,b.endAngle)}else for(var x=0;x<o.length;x++){var N=o[x].substring(0,1),M=o[x].substring(1),E=s[x].substring(1);switch(i+=N.toUpperCase(),N){case"h":case"v":i+=(parseFloat(E)-parseFloat(M))*r+parseFloat(M);break;case"m":case"l":for(var F=M.split(","),I=E.split(","),O=0;O<F.length;O++)i+=(parseFloat(I[O])-parseFloat(F[O]))*r+parseFloat(F[O]),O!==F.length-1&&(i+=",")}}"z"===e.charAt(e.length-1)&&(i+="Z")}return i}},{key:"arcTransition",value:function(t,e,a,r,n,i){var o=function(t,e){return e<t?function(){throw"startAngle should smaller than endAngle"}():null};o(t,e),o(a,r);var s=function(t,e){return e-2*Math.PI*Math.floor((e-t)/Math.PI/2)};e=s(t,e),a=s(t,a),r=s(a,r),r=s(a-=Math.abs(a-t)+Math.abs(r-e)<2*Math.PI?0:2*Math.PI,r);var u=i||function(t,e,a){return a*(e-t)+t};return[u(t,a,n),u(e,r,n)]}},{key:"findDiffCmds",value:function(e){var a=new Map;return e.forEach(function(e,r){for(var n=[],i=0;i<e.length;i++)void 0!==e[i]&&e[i].d&&n.push(e[i].d);n.length>0&&t.compareD(n,a)}),a}},{key:"compareD",value:function(t,e){for(var a=new RegExp(/[mlhvcsqta][^mlhvcsqtaz]*/g),n=t[0],i=(n=(n=n.toLowerCase()).replace(/(?<=\d)\s(?=[mlhvcsqtaz])/g,"").replace(/(?<=[mlhvcsqta])\s(?=(\d|[-+]))/g,"").replace(/\s/g,",")).match(a),o=1;o<t.length;o++){var s=t[o],u=(s=(s=s.toLowerCase()).replace(/(?<=\d)\s(?=[mlhvcsqtaz])/g,"").replace(/(?<=[mlhvcsqta])\s(?=(\d|[-+]))/g,"").replace(/\s/g,",")).match(a);if(u.length!==i.length)return null;for(var l=0;l<u.length;l++){var c=u[l].substring(0,1),f=u[l].substring(1),d=i[l].substring(1);if(f!==d){void 0===e.get(c)&&e.set(c,[]);var g={};g.cmdIdx=l,g.diffAttrIdxs=[];for(var m=f.split(","),h=d.split(","),p=0;p<m.length;p++)Math.floor(1e3*parseFloat(m[p]))!==Math.floor(1e3*parseFloat(h[p]))&&g.diffAttrIdxs.push(p);for(var b=!1,y=0;y<e.get(c).length;y++)if(e.get(c)[y].cmdIdx===g.cmdIdx){b=!0,e.get(c)[y].diffAttrIdxs=[].concat(r(new Set([].concat(r(e.get(c)[y].diffAttrIdxs),r(g.diffAttrIdxs)))));break}b||e.get(c).push(g)}}}}},{key:"getTransformAttrs",value:function(t){var e=t.getAttribute("transform");if(e){e=(e=e.replace(/translate|scale|rotate|\s/g,function(t){return" "===t?"":"@"+t})).replace(/(^@*)|(@*$)/g,"").split("@");for(var a="",r="",n=0;n<e.length;n++)e[n].indexOf("translate")>=0?r=e[n]:e[n].indexOf("scale")>=0&&(a=e[n]);var i=r.replace(/translate\(| |\)/g,"").split(",");return{transNums:[parseFloat(i[0]),parseFloat(i[1])],scaleStr:a}}return null}}],(a=null)&&i(e.prototype,a),o&&i(e,o),t}();e.default=o,t.exports=e.default},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=u(a(3)),n=u(a(5)),i=u(a(6)),o=u(a(0)),s=u(a(1));function u(t){return t&&t.__esModule?t:{default:t}}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var a=[],r=!0,n=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done)&&(a.push(o.value),!e||a.length!==e);r=!0);}catch(t){n=!0,i=t}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return a}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e){return!e||"object"!==f(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function m(t,e){return(m=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var h=function(t){function e(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(t=g(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).chartIdx,t.selection,t.grouping=new i.default,t.actions=[],t.domMarks=new Map,t.animationStartTime=1e6,t.animationEndTime=0,t}var a,u,h;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&m(t,e)}(e,o.default),a=e,h=[{key:"renderAnimation",value:function(){var t=this;this.allMarkAni.forEach(function(e,a){t.wholeEndTime<e.startTime+e.totalDuration&&(t.wholeEndTime=e.startTime+e.totalDuration);for(var r,i=new Map,o=new Map,s=0;s<e.actionAttrs.length|(r=e.actionAttrs[s]);s++)r.type===n.default.actionTargets.mark?void 0===o.get(r.attribute.attrName)?o.set(r.attribute.attrName,[r]):o.get(r.attribute.attrName).push(r):r.type===n.default.actionTargets.mask?void 0===i.get(r.attribute.attrName)?i.set(r.attribute.attrName,[r]):i.get(r.attribute.attrName).push(r):console.log("we have some action with no type !!!!!");i.forEach(function(t,a){var r=new n.default;r.type=n.default.actionTargets.mask,r.chartIdx=t[0].chartIdx,r.animationType=t[0].animationType,r.startTime=0,r.duration=t[0].startTime,r.attribute={attrName:t[0].attribute.attrName,from:t[0].attribute.from,to:t[0].attribute.from},e.actionAttrs.push(r);for(var i=0;i<t.length;i++){var o=new n.default;o.type=n.default.actionTargets.mask,o.chartIdx=t[i].chartIdx,o.animationType=t[i].animationType,o.startTime=t[i].startTime+t[i].duration,i===t.length-1?o.duration="wholeEnd":o.duration=t[i+1].startTime-t[i].startTime-t[i].duration,o.attribute={attrName:t[i].attribute.attrName,from:t[i].attribute.to,to:t[i].attribute.to},e.actionAttrs.push(o)}}),o.forEach(function(t,a){var r=new n.default;r.type=n.default.actionTargets.mark,r.animationType=t[0].animationType,r.startTime=0,r.duration=t[0].startTime,r.attribute={attrName:t[0].attribute.attrName,from:t[0].attribute.from,to:t[0].attribute.from},e.actionAttrs.push(r);for(var i=0;i<t.length;i++){var o=new n.default;o.type=n.default.actionTargets.mark,o.animationType=t[i].animationType,o.startTime=t[i].startTime+t[i].duration,i===t.length-1?o.duration="wholeEnd":o.duration=t[i+1].startTime-t[i].startTime-t[i].duration,o.attribute={attrName:t[i].attribute.attrName,from:t[i].attribute.to,to:t[i].attribute.to},e.actionAttrs.push(o)}})}),console.log("whole end time: "+this.wholeEndTime),this.allMarkAni.forEach(function(e,a){for(var r,n=0;n<e.actionAttrs.length|(r=e.actionAttrs[n]);n++)"wholeEnd"===r.duration&&(r.duration=t.wholeEndTime-r.startTime)}),console.log("all mark ani: ",this.allMarkAni)}},{key:"renderFrame",value:function(t){var a=[];return this.allMarkAni.forEach(function(r,n){for(var i,o=new Map,s=0;s<r.actionAttrs.length|(i=r.actionAttrs[s]);s++)if(i.attribute.from!==i.attribute.to||0!==i.duration){var u=e.calAttrValue(i,n,t);u!==(t>=0?e.calAttrValue(i,n,t-1):"")&&(i.startTime<=t&&i.startTime+i.duration>=t?o.set(i.attribute.attrName,{type:i.type,animationType:i.animationType,endTime:i.startTime+i.duration,attrName:i.attribute.attrName,value:u}):i.startTime+i.duration<t&&void 0!==o.get(i.attribute.attrName)&&o.get(i.attribute.attrName).endTime<i.startTime+i.duration&&o.set(i.attribute.attrName,{type:i.type,animationType:i.animationType,endTime:i.startTime+i.duration,attrName:i.attribute.attrName,value:u}))}o.size>0&&a.push([n,o])}),a}},{key:"calAttrValue",value:function(t,e,a){var r,i=t.chartIdx;if(t.startTime<=a&&t.startTime+t.duration>=a){var o=parseFloat(a-t.startTime)/parseFloat(t.duration),u=this.calRatio(o,t.easing);switch(t.attribute.attrName){case"fill":case"stroke":if(t.type===n.default.actionTargets.mark&&Array.isArray(t.attribute.to)){for(var l,c,f=0;f<t.attribute.to.length;f++)if(t.attribute.to[f][0]===e&&"string"==typeof t.attribute.to[f][1]){l=t.attribute.from[f][1],c=t.attribute.to[f][1];break}var d=s.default.color2RGB(l),g=s.default.color2RGB(c);r="rgb("+(parseInt((g[0]-d[0])*u)+d[0])+","+(parseInt((g[1]-d[1])*u)+d[1])+","+(parseInt((g[2]-d[2])*u)+d[2])+")"}break;case"textContent":if(t.type===n.default.actionTargets.mark&&Array.isArray(t.attribute.to)){for(var m=0,h=0;h<t.attribute.to.length;h++)if(t.attribute.to[h][0]===e&&(!isNaN(t.attribute.to[h][1])||"string"==typeof t.attribute.to[h][1])){m=t.attribute.to[h][1];break}r=m}break;case"width":case"height":case"r":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var p=0,b=0,y=0;y<t.attribute.to.length;y++)if(t.attribute.to[y][0]===e&&!isNaN(t.attribute.from[y][1])&&!isNaN(t.attribute.to[y][1])){p=t.attribute.from[y][1],b=t.attribute.to[y][1];break}r=p+(b-p)*u}else{var v=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);r=0-(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(0-v)}else{var A=parseFloat(this.minStatus.get(t.attribute.attrName)),k=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);r=A<0?A+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(k-A):(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*k}break;case"y":case"y1":case"y2":case"cy":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var T=0,w=0,S=0;S<t.attribute.to.length;S++)if(t.attribute.to[S][0]===e&&!isNaN(t.attribute.from[S][1])&&!isNaN(t.attribute.to[S][1])){T=t.attribute.from[S][1],w=t.attribute.to[S][1];break}r=T+(w-T)*u}else{var x=this.startY,N=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);r=x-(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(x-N)}else t.type===n.default.actionTargets.mask&&(r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName])-1+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(parseFloat(this.finalStatus.get(e)[i].height)+2));break;case"x":case"x1":case"x2":case"cx":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var M=0,E=0,F=0;F<t.attribute.to.length;F++)if(t.attribute.to[F][0]===e&&!isNaN(t.attribute.from[F][1])&&!isNaN(t.attribute.to[F][1])){M=t.attribute.from[F][1],E=t.attribute.to[F][1];break}r=M+(E-M)*u}else{var I=this.startX,O=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);r=I+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(O-I)}else t.type===n.default.actionTargets.mask&&(r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName])-1+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(parseFloat(this.finalStatus.get(e)[i].width)+2));break;case"startAngle":var C,R=parseFloat(this.finalStatus.get(e)[i].startAngle),_=parseFloat(this.finalStatus.get(e)[i].endAngle),B=R<0?R+2*Math.PI:R,j=_<0||B>_?_+2*Math.PI:_;C=j>B?B+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(j-B):B+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(2*Math.PI-B+j),r={cx:parseFloat(this.finalStatus.get(e)[i].cx),cy:parseFloat(this.finalStatus.get(e)[i].cy),innerRadius:parseFloat(this.finalStatus.get(e)[i].innerRadius),outterRadius:parseFloat(this.finalStatus.get(e)[i].outterRadius)+2,startAngle:C,endAngle:parseFloat(this.finalStatus.get(e)[i].endAngle)};break;case"innerRadius":var P=parseFloat(this.finalStatus.get(e)[i].innerRadius),L=parseFloat(this.finalStatus.get(e)[i].outterRadius),q=(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(L-P);r=q<0?{cx:parseFloat(this.finalStatus.get(e)[i].cx),cy:parseFloat(this.finalStatus.get(e)[i].cy),innerRadius:parseFloat(this.finalStatus.get(e)[i].innerRadius)+2,outterRadius:parseFloat(this.finalStatus.get(e)[i].outterRadius)-q+2,startAngle:parseFloat(this.finalStatus.get(e)[i].startAngle),endAngle:parseFloat(this.finalStatus.get(e)[i].endAngle)}:{cx:parseFloat(this.finalStatus.get(e)[i].cx),cy:parseFloat(this.finalStatus.get(e)[i].cy),innerRadius:parseFloat(this.finalStatus.get(e)[i].innerRadius)+q+2,outterRadius:parseFloat(this.finalStatus.get(e)[i].outterRadius)+2,startAngle:parseFloat(this.finalStatus.get(e)[i].startAngle),endAngle:parseFloat(this.finalStatus.get(e)[i].endAngle)};break;case"stroke-dashoffset":var D=parseFloat(this.finalStatus.get(e)[i]["stroke-dasharray"]);r=0-(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(0-D);break;case"d":if(t.type===n.default.actionTargets.mark&&Array.isArray(t.attribute.to)){for(var H="",z="",V=0;V<t.attribute.to.length;V++)if(t.attribute.to[V][0]===e&&t.attribute.from[V][1]&&t.attribute.to[V][1]){H=t.attribute.from[V][1],z=t.attribute.to[V][1];break}r=s.default.calTransD(H,z,u)}break;default:var Q=parseFloat(this.minStatus.get(t.attribute.attrName)),G=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);r=Q<0?Q+(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*(G-Q):(parseFloat(t.attribute.to-t.attribute.from)*u+t.attribute.from)*G}}else if(t.startTime+t.duration<a)switch(t.attribute.attrName){case"fill":case"stroke":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var J=0;J<t.attribute.to.length;J++)if(t.attribute.to[J][0]===e&&"string"==typeof t.attribute.to[J][1]){r=t.attribute.to[J][1];break}}else r=this.finalStatus.get(e)[i][t.attribute.attrName];break;case"textContent":if(t.type===n.default.actionTargets.mark&&Array.isArray(t.attribute.to)){for(var X=0,Z=0;Z<t.attribute.to.length;Z++)if(t.attribute.to[Z][0]===e&&(!isNaN(t.attribute.to[Z][1])||"string"==typeof t.attribute.to[Z][1])){X=t.attribute.to[Z][1];break}r=X}break;case"width":case"height":case"r":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var W=0,Y=0;Y<t.attribute.to.length;Y++)if(t.attribute.to[Y][0]===e){W=t.attribute.to[Y][1];break}r=W}else r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);else r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);break;case"y":case"y1":case"y2":case"cy":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var U=0,$=0;$<t.attribute.to.length;$++)if(t.attribute.to[$][0]===e){U=t.attribute.to[$][1];break}r=U}else r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);else t.type===n.default.actionTargets.mask&&(r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName])+parseFloat(this.finalStatus.get(e)[i].height));break;case"x":case"x1":case"x2":case"cx":if(t.type===n.default.actionTargets.mark)if(Array.isArray(t.attribute.to)){for(var K=0,tt=0;tt<t.attribute.to.length;tt++)if(t.attribute.to[tt][0]===e){K=t.attribute.to[tt][1];break}r=K}else r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName]);else t.type===n.default.actionTargets.mask&&(r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName])+parseFloat(this.finalStatus.get(e)[i].height));break;case"startAngle":case"innerRadius":r={cx:parseFloat(this.finalStatus.get(e)[i].cx),cy:parseFloat(this.finalStatus.get(e)[i].cy),innerRadius:parseFloat(this.finalStatus.get(e)[i].innerRadius),outterRadius:parseFloat(this.finalStatus.get(e)[i].outterRadius),startAngle:parseFloat(this.finalStatus.get(e)[i].startAngle),endAngle:parseFloat(this.finalStatus.get(e)[i].endAngle)};break;default:r=parseFloat(this.finalStatus.get(e)[i][t.attribute.attrName])}return r}},{key:"calRatio",value:function(t,e){var a=0;switch(e){case n.default.easingType.easeLinear:a=t;break;case n.default.easingType.easeInQuad:a=this.easeFuncs.easeInQuad(t);break;case n.default.easingType.easeOutQuad:a=this.easeFuncs.easeOutQuad(t);break;case n.default.easingType.easeInOutQuad:a=this.easeFuncs.easeInOutQuad(t);break;case n.default.easingType.easeInCubic:a=this.easeFuncs.easeInCubic(t);break;case n.default.easingType.easeOutCubic:a=this.easeFuncs.easeOutCubic(t);break;case n.default.easingType.easeInOutCubic:a=this.easeFuncs.easeInOutCubic(t);break;case n.default.easingType.easeOutBounce:a=this.easeFuncs.easeOutBounce(t)}return a}},{key:"resetAll",value:function(){this.wholeEndTime=0,this.allMarkAni.clear(),this.minStatus.clear(),this.finalStatus.clear(),this.frames.clear()}}],(u=[{key:"translate",value:function(t,e){if(console.log("used changed attrs: ",e),this.checkFormat(t)&&(this.chartIdx=t.chartIdx,this.selection=t.selection,this.reference=t.reference,this.offset=t.offset,void 0!==t.grouping&&this.grouping.initGrouping(t.grouping),console.log("chart index: ",t.chartIdx),console.log("changed attrs: ",r.default.changedAttrs),console.log("mark trans: ",r.default.dataTrans),void 0!==t.actions))for(var a,i=0;i<t.actions.length|(a=t.actions[i]);i++){a.chartIdx=t.chartIdx;for(var o,s=n.default.transToVisualAttrAction(a,t.chartIdx,e,r.default.dataTrans),u=0;u<s.length|(o=s[u]);u++){var l=new n.default;l.initAction(o),this.actions.push(l)}}}},{key:"checkFormat",value:function(t){return!!Object.keys(t).includes("selection")||(alert("illegal format, no 'selection' is defined "),!1)}},{key:"calAniTime",value:function(t,a){for(var r,i=this,o=new Map,s=0;s<t.length|(r=t[s]);s++){for(var u,d=new Map,g=0;g<this.actions.length|(u=this.actions[g]);g++)if("object"===f(u.duration)){var m=this.domMarks.get(r)["data-datum"],h=parseFloat(m[u.duration.field]),p=void 0===u.duration.minDuration?300:u.duration.minDuration;d.set(u.duration.field,[h,p])}o.set(r,d)}for(var b,y=c(n.default.calActionDuration(this.actions,o,this.domMarks),3),v=y[0],A=y[1],k=y[2],T=this.grouping.arrangeOrder(t,this.domMarks),w=new Map,S=new Map,x=0;x<T.length|(b=T[x]);x++){for(var N,M={},E=0;E<e.visualAttrs.length|(N=e.visualAttrs[E]);E++){if(void 0===this.domMarks.get(b)[N])switch(N){case"opacity":M[N]=1;break;case"width":M[N]=this.domMarks.get(b).bbWidth;break;case"height":M[N]=this.domMarks.get(b).bbHeight;break;case"x":M[N]=this.domMarks.get(b).bbX;break;case"y":M[N]=this.domMarks.get(b).bbY;break;case"cx":M[N]=this.domMarks.get(b).bbX+this.domMarks.get(b).bbWidth/2;break;case"cy":M[N]=this.domMarks.get(b).bbY+this.domMarks.get(b).bbHeight/2;break;case"innerRadius":M[N]=0;break;case"outterRadius":M[N]=Math.sqrt(Math.pow(this.domMarks.get(b).bbWidth/2,2)+Math.pow(this.domMarks.get(b).bbHeight/2,2));break;case"startAngle":M[N]=0;break;case"endAngle":M[N]=2*Math.PI}else M[N]=this.domMarks.get(b)[N];""!==M[N]&&(void 0===e.minStatus.get(N)?e.minStatus.set(N,M[N]):parseFloat(e.minStatus.get(N))>parseFloat(M[N])&&e.minStatus.set(N,M[N]))}void 0===e.finalStatus.get(b)&&e.finalStatus.set(b,[]),e.finalStatus.get(b).push(M),w.set(b,{startTime:0,totalDuration:v.get(b),actionAttrs:[]}),S.set(b,"allMarks")}this.grouping.calTimeInGrouping(w,this.domMarks);var F=1e4;w.forEach(function(t,e){t.startTime<F&&(F=t.startTime)});var I=void 0===a?this.calOffsetTime(0,0,F,this.domMarks):this.calOffsetTime(a.animationStartTime,a.animationEndTime,F,this.domMarks);console.log("processed actions: ",k),w.forEach(function(t,e){var a={startTime:t.startTime+I.get(e),totalDuration:t.totalDuration,actionAttrs:[]};a.startTime<i.animationStartTime&&(i.animationStartTime=a.startTime),a.startTime+a.totalDuration>i.animationEndTime&&(i.animationEndTime=a.startTime+a.totalDuration);for(var r,o=0;o<k.length|(r=k[o]);o++){for(var s,u=new n.default,l=Object.keys(r),c=0;c<l.length|(s=l[c]);c++)if(u[s]=r[s],"_duration"===s&&"object"===f(r[s])){var d=i.domMarks.get(e)["data-datum"],g=A.get(r[s].field);u[s]=r[s].minDuration*parseFloat(d[r[s].field])/g}else"offsetStart"===s&&(u[s]=r[s].get(e));a.actionAttrs.push(u)}w.set(e,a)}),w.forEach(function(t,a){for(var r=0;r<t.actionAttrs.length;r++)t.actionAttrs[r].startTime=t.startTime+t.actionAttrs[r].offsetStart;if(void 0===e.allMarkAni.get(a))e.allMarkAni.set(a,t);else{var n=e.allMarkAni.get(a).startTime,i=n+e.allMarkAni.get(a).totalDuration;e.allMarkAni.get(a).startTime=n<t.startTime?n:t.startTime;var o=t.startTime+t.totalDuration;i=i>o?i:o,e.allMarkAni.get(a).totalDuration=i-e.allMarkAni.get(a).startTime,e.allMarkAni.get(a).actionAttrs=[].concat(l(e.allMarkAni.get(a).actionAttrs),l(t.actionAttrs))}}),console.log("all mark animation: ",e.allMarkAni)}}])&&d(a.prototype,u),h&&d(a,h),e}();h.visualAttrs=["x","y","cx","cy","innerRadius","outterRadius","startAngle","endAngle","width","height","opacity","fill","stroke","content","stroke-dasharray","stroke-dashoffset"],h.startY=0,h.startX=0,h.endX=0,h.wholeEndTime=0,h.minStatus=new Map,h.finalStatus=new Map,h.allMarkAni=new Map,h.frames=new Map,h.easeFuncs={easeInQuad:function(t){return t*t},easeOutQuad:function(t){return-t*(t-2)},easeInOutQuad:function(t){return t/2<1?.5*t*t:-(--t*(t-2)-1)/2},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return(t-=1)*t*t+1},easeInOutCubic:function(t){return(t/=.5)<1?t*t*t/2:((t-=2)*t*t+2)/2},easeOutBounce:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}};var p=h;e.default=p,t.exports=e.default},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,n=(r=a(1))&&r.__esModule?r:{default:r};function i(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var o=function(){function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.source=a}var e,a,r;return e=t,r=[{key:"loadCharts",value:function(e,a){var r=new Map;t.charts=[];for(var n=[],i=0;i<e.length;i++){var o=new XMLHttpRequest,s="file:"===document.location.protocol?0:200,u=void 0;if(o.open("GET",e[i].source,!1),o.overrideMimeType("text/html;charset=utf-8"),o.send(null),o.status===s){var l=document.createElement("div");l.innerHTML=o.responseText,u=l.children[0],t.charts.push(u),r.set(e[i].name,t.charts.length-1)}else 404===o.status&&(n.unshift(i),console.log("can not find "+e[i].source+" ! Please check the url."))}for(var c=0;c<n.length;c++)e.slice(n[c],1);console.log("testing facet: ",a),void 0!==a&&t.facetViews(r,a)}},{key:"removeTransAndMerge",value:function(){for(var e=0;e<t.charts.length;e++)t.charts[e].setAttribute("trans","0,0"),t.removeTransitions(t.charts[e].children[0]);return t.mergeCharts()}},{key:"facetViews",value:function(e,a){for(var r=[],n=0;n<a.views[0].length;n++){for(var i=[],o=0;o<a.views.length;o++){var s=a.views[o][n];void 0!==e.get(s)?i.push(t.charts[e.get(s)]):console.log("chart name "+s+" is undefined !")}i.length===a.views.length&&r.push(i)}t.combineCharts(a.type,r)}},{key:"combineCharts",value:function(e,a){for(var r=[],i=0;i<a.length;i++){var o=a[i],s=parseFloat(o[0].getAttribute("width")),u=parseFloat(o[0].getAttribute("height"));switch(e){case"row":o[0].setAttribute("wdith",s*o.length),o[0].setAttribute("viewBox","0 0 "+s*o.length+" "+u);break;case"col":o[0].setAttribute("height",u*o.length),o[0].setAttribute("viewBox","0 0 "+s+" "+u*o.length)}for(var l=function(t){var a=o[t],r=a.querySelectorAll(".mark");if([].forEach.call(r,function(e){var a=parseInt(e.getAttribute("id").substring(4));e.setAttribute("id","mark"+(a+1e5*t)),e.classList.add("facet"+t)}),t>0)for(var i=a.children[0].children,l=0;l<i.length;l++){var c=i[l],f=n.default.getTransformAttrs(c);switch(e){case"row":c.setAttribute("transform","translate("+(f.transNums[0]+s*t)+","+f.transNums[1]+" "+f.scaleStr);break;case"col":c.setAttribute("transform","translate("+f.transNums[0]+","+(f.transNums[1]+u*t)+" "+f.scaleStr)}o[0].children[0].appendChild(c)}},c=0;c<o.length;c++)l(c);r.push(o[0])}t.charts=r}},{key:"mergeCharts",value:function(){for(var e=new Set,a=new Map,r=new Map,i=["x","y","cx","cy","x1","y1","x2","y2","d","r","width","height","textContent","fill","stroke"],o=function(n){var o=t.charts[n].querySelectorAll(".mark");o.length>0&&[].forEach.call(o,function(t){var o=t.getAttribute("id");e.add(o);for(var s={},u=0;u<i.length;u++)s[i[u]]="textContent"===i[u]?t.innerHTML:t.getAttribute(i[u]);void 0===a.get(o)&&a.set(o,[]),a.get(o)[n]=s,r.set(o,t.outerHTML)})},s=0;s<t.charts.length;s++)o(s);console.log("all marks: ",e),t.changedAttrs=[];var u=n.default.deepClone(i);a.forEach(function(e,a){for(var r=0;r<u.length;r++){for(var n=!0,i=void 0,o=0;o<e.length;o++)if(void 0!==e[o]){i=e[o];break}for(var s=0;s<e.length;s++)if(void 0!==e[s]&&e[s][u[r]]!==i[u[r]]){t.changedAttrs.push(u[r]),n=!1;break}if(!n){u.splice(r,1);break}}}),console.log("changedAttrs:",t.changedAttrs);var l=new Map;for(t.changedAttrs.indexOf("d")>=0&&(l=n.default.findDiffCmds(a)),e=Array.from(e),t.markDoms.clear(),s=0;s<t.charts.length;s++)for(var c=0;c<e.length;c++)if(0===t.charts[s].querySelectorAll("#"+e[c]).length){console.log("chart ",s,"does not have mark",e[c]);var f=r.get(e[c]),d=document.createElement("div");d.innerHTML=f;for(var g=d.children[0],m={},h=0;h<t.changedAttrs.length;h++)if("y"===t.changedAttrs[h]&&t.changedAttrs.indexOf("height")>=0){var p=parseFloat(g.getAttribute("y"))+parseFloat(g.getAttribute("height"));g.setAttribute("y",p),m.y=p}else if("d"===t.changedAttrs[h]){var b=void 0;g.getAttribute("d")&&(b=n.default.setPathDValue(g.getAttribute("d"),!0,0,0,l)),g.setAttribute("d",b),m.d=b}else"textContent"===t.changedAttrs[h]?(g.innerHTML="",m.textContent=""):"fill"===t.changedAttrs[h]||"stroke"===t.changedAttrs[h]?(console.log(e[c],"color: ",t.changedAttrs[h],g.getAttribute(t.changedAttrs[h])),void 0===g.getAttribute(t.changedAttrs[h])&&g.setAttribute(t.changedAttrs[h],"#FFFFFF"),m[t.changedAttrs[h]]=g.getAttribute(t.changedAttrs[h])):(g.setAttribute(t.changedAttrs[h],0),m[t.changedAttrs[h]]=0);f='<svg xmlns="http://www.w3.org/2000/svg" width="500" height="500">'+g.outerHTML+"</svg>";var y=(new DOMParser).parseFromString(f,"image/svg+xml").lastChild.children[0];t.charts[s].querySelector("#chartContent").appendChild(y),a.get(e[c])[s]=m}console.log("mark status: ",a),t.dataTrans=new Map;for(var v=0;v<e.length;v++){for(var A=a.get(e[v]),k=[],T=0;T<A.length;T++){for(var w={},S=0;S<t.changedAttrs.length;S++)w[t.changedAttrs[S]]=A[T][t.changedAttrs[S]];k.push(w)}t.dataTrans.set(e[v],k),t.charts[0].querySelector("#"+e[v]).setAttribute("data-transition",JSON.stringify({dataTrans:k},null,"\t"))}return console.log("final data trans: ",t.dataTrans),t.charts[0]}},{key:"getBBoxes",value:function(){var t=document.getElementById("chartContainer").children[0].querySelectorAll('[id^="mark"]'),e=new Map;return t.length>0&&[].forEach.call(t,function(t){var a,r=t.getAttribute("id");"text"===t.tagName?(a=t.getBBox()).width+=10:a=t.getBBox(),e.set(r,a)}),e}},{key:"removeTransitions",value:function(e){var a=e.getAttribute("transform"),r=e.parentNode.getAttribute("trans").split(",");if(a){a=(a=a.replace(/translate|scale|rotate|\s/g,function(t){return" "===t?"":"@"+t})).replace(/(^@*)|(@*$)/g,"").split("@");for(var i="",o="",s=0;s<a.length;s++)a[s].indexOf("translate")>=0?o=a[s]:a[s].indexOf("scale")>=0&&(i=a[s]);var u=o.replace(/translate\(| |\)/g,"").split(",");e.setAttribute("transform",i),"g"===e.tagName?e.setAttribute("trans",parseFloat(u[0])+parseFloat(r[0])+","+(parseFloat(u[1])+parseFloat(r[1]))):n.default.transShape(e,parseFloat(u[0])+parseFloat(r[0]),parseFloat(u[1])+parseFloat(r[1]))}else"g"===e.tagName?e.setAttribute("trans",r.join(",")):n.default.transShape(e,parseFloat(r[0]),parseFloat(r[1]));if(e.children.length>0)for(var l=0;l<e.children.length;l++)t.removeTransitions(e.children[l])}},{key:"getMarkBBox",value:function(t){var e=new Map,a=t.querySelectorAll('[id^="mark"]');return a.length>0&&[].forEach.call(a,function(t){if("text"!==t.tagName)e.set(t.getAttribute("id"),t.getBBox());else{var a=t.getBBox();a.y-=a.height,a.width+=10,e.set(t.getAttribute("id"),a)}}),e}},{key:"processAnimateChart",value:function(t,e){var a=document.createElement("div");a.innerHTML=t;var r=a.children[0];r.setAttribute("id","visAnimation"),r.querySelector("#chartContent").setAttribute("id","aniChartContent");var n=r.querySelectorAll('[id^="mark"]');return n.length>0&&[].forEach.call(n,function(t){var a=t.getAttribute("id"),n=a.substring(4);t.setAttribute("id","ani"+a);var i=document.createElementNS("http://www.w3.org/2000/svg","mask");i.setAttributeNS(null,"id","animaskmark"+n);var o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttributeNS(null,"id","animaskBgmark"+n),o.setAttributeNS(null,"x",e.get(a).x-1),o.setAttributeNS(null,"y",e.get(a).y-1),o.setAttributeNS(null,"width",e.get(a).width+2),o.setAttributeNS(null,"height",e.get(a).height+2),o.setAttributeNS(null,"fill","#fff"),i.appendChild(o);var s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttributeNS(null,"x",-1e4),s.setAttributeNS(null,"y",-1e4),s.setAttributeNS(null,"width",2e4),s.setAttributeNS(null,"height",2e4),s.setAttributeNS(null,"fill","#fff"),i.appendChild(s),r.appendChild(i),t.setAttribute("mask","url(#animaskmark"+n+")")}),r}}],(a=null)&&i(e.prototype,a),r&&i(e,r),t}();o.charts=[],o.changedAttrs=[],o.dataTrans=new Map,o.markDoms=new Map;var s=o;e.default=s,t.exports=e.default},function(t,e,a){var r=a(0),n=a(2),i=a(7),o=a(9);window.aniChart={frameRate:r.FRAME_RATE,duration:function(){return n.wholeEndTime},loadSpec:function(t,e){i.loadSpec(t,e)},renderSpec:function(t){var e=new i;e.init(t),e.render()},play:function(){o.play()},renderFrame:function(t){return o.renderFrame(t)},reset:function(){o.resetCover(),n.resetAll()}}},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,n=(r=a(0))&&r.__esModule?r:{default:r};function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var c=function(t){function e(){var t;return o(this,e),(t=u(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).chartIdx=0,t._type=e.actionTypes.appear,t.animationType="",t._easing=e.easingType.easeLinear,t._duration=0,t.startTime,t.attribute=function(){return function t(){o(this,t),this.attrName,this.from,this.to}}(),t}var a,r,c;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&l(t,e)}(e,n.default),a=e,c=[{key:"transToVisualAttrAction",value:function(t,a,r,i){for(var o=[],s=function(s){var u=r[s],l=[],c=[];console.log("change attr: ",u),i.forEach(function(t,e){a+1<t.length&&("d"===u||"textContent"===u||"fill"===u||"stroke"===u?(l.push([e,t[a][u]]),c.push([e,t[a+1][u]])):(l.push([e,parseFloat(t[a][u])]),c.push([e,parseFloat(t[a+1][u])])))});var f={chartIdx:t.chartIdx,reference:n.default.timingRef.previousStart,offset:0,duration:t.type===e.actionTypes.transition?t.duration:0,type:e.actionTargets.mark,animationType:e.targetAnimationType.custom,attribute:{attrName:u,from:l,to:c}};console.log(f),o.push(f)},u=0;u<r.length;u++)s(u);if(t.type!==e.actionTypes.transition){var l={chartIdx:t.chartIdx,reference:t.reference,offset:t.offset,easing:t.easing,duration:void 0===t.duration?300:t.duration,type:e.actionTargets.mask};switch(t.type){case e.actionTypes.fade:l.animationType=e.targetAnimationType.fade,l.attribute={attrName:"opacity",from:1,to:0};break;case e.actionTypes.fadeOut:l.animationType=e.targetAnimationType.fade,l.attribute={attrName:"opacity",from:0,to:1};break;case e.actionTypes.wipeBottom:l.animationType=e.targetAnimationType.wipe,l.attribute={attrName:"height",from:1,to:0};break;case e.actionTypes.wipeOutFromTop:l.animationType=e.targetAnimationType.wipe,l.attribute={attrName:"height",from:0,to:1};break;case e.actionTypes.wipeTop:l.animationType=e.targetAnimationType.move,l.attribute={attrName:"y",from:0,to:1};break;case e.actionTypes.wipeOutFromBottom:l.animationType=e.targetAnimationType.move,l.attribute={attrName:"y",from:1,to:0};break;case e.actionTypes.wipeLeft:l.animationType=e.targetAnimationType.move,l.attribute={attrName:"x",from:0,to:1};break;case e.actionTypes.wipeOutFromRight:l.animationType=e.targetAnimationType.move,l.attribute={attrName:"x",from:1,to:0};break;case e.actionTypes.wipeRight:l.animationType=e.targetAnimationType.wipe,l.attribute={attrName:"width",from:1,to:0};break;case e.actionTypes.wipeOutFromLeft:l.animationType=e.targetAnimationType.wipe,l.attribute={attrName:"width",from:0,to:1};break;case e.actionTypes.wheel:l.animationType=e.targetAnimationType.wheel,l.attribute={attrName:"startAngle",from:0,to:1};break;case e.actionTypes.wheelOut:l.animationType=e.targetAnimationType.wheel,l.attribute={attrName:"startAngle",from:1,to:0};break;case e.actionTypes.circle:l.animationType=e.targetAnimationType.circle,l.attribute={attrName:"innerRadius",from:0,to:1};break;case e.actionTypes.circleOut:l.animationType=e.targetAnimationType.circle,l.attribute={attrName:"innerRadius",from:1,to:0};break;case e.actionTypes.grow:l.type=e.actionTargets.mark,l.animationType=e.targetAnimationType.grow,l.attribute={attrName:"stroke-dashoffset",from:1,to:0};break;case e.actionTypes.degrow:l.type=e.actionTargets.mark,l.animationType=e.targetAnimationType.grow,l.attribute={attrName:"stroke-dashoffset",from:0,to:1};break;case e.actionTypes.appear:l.duration=1e3/n.default.FRAME_RATE+4,l.animationType=e.targetAnimationType.appear,l.attribute={attrName:"fill",from:"#000",to:"#fff"};break;case e.actionTypes.custom:l.type=e.actionTargets.mark,l.animationType=e.targetAnimationType.custom,l.attribute={},void 0!==t.attribute&&(l.attribute={attrName:t.attribute.attrName,from:t.attribute.from,to:t.attribute.to})}o.push(l)}return o}},{key:"calActionDuration",value:function(t,a,r){console.log("all actions: ",t);for(var n=0,o=-1e5,s=0,u=0,l=!1,c=function(a){var c=void 0,f=new Map;c=t[a].calOffsetTime(s,u,0,r),a>0&&t[a-1].animationType===e.targetAnimationType.mistake&&c.forEach(function(e,r){c.set(r,e-t[a-1].offset)});var d=1e6,g=-1e5;t[a].offsetStart=new Map,c.forEach(function(e,r){var s=0;"object"===i(t[a].duration)?(l=!0,s=e):"number"==typeof t[a].duration&&(s=e+t[a].duration),f.set(r,s),t[a].offsetStart.set(r,e),e<d&&(d=e),s>g&&(g=s),e<n&&(n=e),s>o&&(o=s)}),s=d,u=g},f=0;f<t.length;f++)c(f);var d=o-n,g=new Map,m=new Map;return l?(a.forEach(function(t,e){t.forEach(function(t,e){(void 0===m.get(e)||t[0]<m.get(e))&&m.set(e,t[0])})}),a.forEach(function(t,e){var a=0;t.forEach(function(t,e){var r=m.get(e);a+=t[1]*t[0]/r}),g.set(e,d+a)})):a.forEach(function(t,e){g.set(e,d)}),[g,m,t]}}],(r=[{key:"initAction",value:function(t){this.chartIdx=t.chartIdx,this.type=t.type,this.animationType=t.animationType,this.reference=t.reference,this.offset=t.offset,this.duration=t.duration,this.easing=t.easing,void 0!==t.attribute&&(this.attribute.attrName=t.attribute.attrName,this.attribute.from=t.attribute.from,this.attribute.to=t.attribute.to)}},{key:"type",set:function(t){void 0!==t&&(Object.keys(e.actionTypes).includes(t)?this._type=t:alert("the 'type' of action is not defined. "))},get:function(){return this._type}},{key:"easing",set:function(t){void 0!==t&&(Object.keys(e.easingType).includes(t)?this._easing=t:alert("the 'easing' of action is not defined. "))},get:function(){return this._easing}},{key:"duration",set:function(t){void 0!==t&&(this._duration="number"==typeof t?Math.floor(t/(1e3/n.default.FRAME_RATE))*(1e3/n.default.FRAME_RATE):t)},get:function(){return this._duration}}])&&s(a.prototype,r),c&&s(a,c),e}();c.actionTypes={fade:"fade",wipeBottom:"wipe bottom",wipeTop:"wipe top",wipeLeft:"wipe left",wipeRight:"wipe right",wheel:"wheel",appear:"appear",circle:"circle",grow:"grow",custom:"custom",fadeOut:"fade out",wipeOutFromLeft:"wipe out from left",wipeOutFromTop:"wipe out from top",wipeOutFromRight:"wipe out from right",wipeOutFromBottom:"wipe out from bottom",wheelOut:"wheel out",circleOut:"circle out",degrow:"degrow",transition:"magic move",mark:"mask",mask:"mark"},c.actionTargets={mark:"mark",mask:"mask"},c.targetAnimationType={fade:"fade",wipe:"wipe",move:"move",wheel:"wheel",circle:"circle",appear:"appear",grow:"grow",custom:"custom",mistake:"mistake"},c.easingType={easeLinear:"easeLinear",easeInQuad:"easeInQuad",easeOutQuad:"easeOutQuad",easeInOutQuad:"easeInOutQuad",easeInCubic:"easeInCubic",easeOutCubic:"easeOutCubic",easeInOutCubic:"easeInOutCubic",easeOutBounce:"easeOutBounce"};var f=c;e.default=f,t.exports=e.default},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r,n=(r=a(0))&&r.__esModule?r:{default:r};function i(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function l(t,e){return!e||"object"!==o(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(t){function e(){var t;return s(this,e),(t=l(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)))._groupBy="marks",t._reference=n.default.timingRef.previousStart,t._delay=0,t.sort=function(){return function t(){s(this,t),this.field,this.order,this.expr}}(),t.grouping,t}var a,r,f;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}(e,n.default),a=e,(r=[{key:"initGrouping",value:function(t){this.groupBy=t.groupBy,this.reference=t.reference,this.delay=t.delay,void 0!==t.sort&&(this.sort.field=t.sort.field,this.sort.order=t.sort.order,this.sort.expr=t.sort.expr),void 0!==t.grouping?(this.grouping=new e,this.grouping.initGrouping(t.grouping)):void 0===t.grouping&&"id"!==t.groupBy&&(this.grouping=new e,this.grouping.groupBy="id")}},{key:"arrangeOrder",value:function(t,e){var a={groupRef:"root",children:[]};return a.marks=t,this.generateTree(a,e),this.getMarkOrder(a)}},{key:"generateTree",value:function(t,a){for(var r,n=this.groupBy,s=new Map,u=0;u<t.marks.length|(r=t.marks[u]);u++){var l=a.get(r)["data-datum"],c=void 0;if(void 0!==a.get(r)[n])c=a.get(r)[n];else{if(void 0!==a.get(r)[n]||void 0===l[n])return void console.log("error: grouping by an unknown attribute");c=l[n]}if(void 0!==s.get(c))s.get(c).marks.push(r);else{var f={};f.groupRef=n,f.refValue=c,f.children=[],f.marks=[r],s.set(c,f)}}switch(o(this.sort.order)){case"object":for(var d,g=0;g<this.sort.order.length|(d=this.sort.order[g]);g++)void 0!==s.get(d)&&t.children.push(s.get(d));break;case"string":var m=!0;if(s.forEach(function(t,e){t.marks.length>1&&(m=!1)}),void 0!==this.sort.field&&m){var h=this.sort.field,p=[].concat(i(s)),b=this.sort.order;p.sort(function(t,r){var n=t[1].marks[0],i=r[1].marks[0],o="",s="",u=a.get(n)["data-datum"],l=a.get(i)["data-datum"];return void 0!==a.get(n)[h]&&"undefined"!==a.get(i)[h]?(o=a.get(n)[h],s=a.get(i)[h]):void 0===a.get(n)[h]&&void 0!==u[h]&&void 0===a.get(i)[h]&&void 0!==l[h]&&(o=u[h],s=l[h]),isNaN(parseFloat(o))||(o=parseFloat(o)),isNaN(parseFloat(s))||(s=parseFloat(s)),b===e.orderTypes.ascending?o>=s?1:-1:b===e.orderTypes.descending?s>=o?1:-1:b===e.orderTypes.random?Math.random()>=.5?1:-1:void 0});for(var y,v=0;v<p.length|(y=p[v]);v++)t.children.push(y[1])}else{var A=[].concat(i(s));this.sort.order===e.orderTypes.ascending?A.sort(function(t,e){return t[0]>=e[0]?1:-1}):this.sort.order===e.orderTypes.descending?A.sort(function(t,e){return e[0]>=t[0]?1:-1}):this.sort.order===e.orderTypes.random&&A.sort(function(t,e){return Math.random()>=.5?1:-1});for(var k,T=0;T<A.length|(k=A[T]);T++)t.children.push(k[1])}break;default:s.forEach(function(e,a){t.children.push(e)})}if(void 0!==this.grouping)for(var w,S=0;S<t.children.length|(w=t.children[S]);S++)this.grouping.generateTree(w,a)}},{key:"getMarkOrder",value:function(t){var e=[];if(null!=t){var a=[];for(a.unshift(t);0!=a.length;){var r=a.shift(),n=r.children;if(n.length<=0)e=[].concat(i(e),i(r.marks));else for(var o=0;o<n.length;o++)a.push(n[o])}}return e}},{key:"calTimeInGrouping",value:function(t,e){var a=this.groupBy,r=new Map;if(t.forEach(function(t,n){var i=e.get(n)["data-datum"];void 0!==e.get(n)[a]?r.set(n,e.get(n)[a]):void 0===e.get(n)[a]&&void 0!==i[a]?r.set(n,i[a]):console.log("error: grouping by an unknown attribute")}),void 0!==this.grouping){this.grouping.calTimeInGrouping(t,e);for(var o,s,u=[].concat(i(r)),l="",c=new Array,f=new Map,d=0;d<u.length;d++){var g=u[d][0],m=u[d][1];m!==l&&(this.updateGroupingTime(o,s,f,c,t),o=c[0],s=c[c.length-1],f=c,c=[],l=m),c.push(g)}this.updateGroupingTime(o,s,f,c,t)}else{var h=[].concat(i(t.entries()));h[0][1].startTime=0;for(var p=1;p<h.length;p++){var b=void 0,y=h[p-1][1].startTime,v=y+h[p-1][1].totalDuration;switch(this.reference){case n.default.timingRef.previousStart:b=y+this.delay;break;case n.default.timingRef.previousEnd:b=v+this.delay;break;case n.default.timingRef.absolute:b=this.delay;break;default:b=y+this.delay}h[p][1].startTime=b,t.set(h[p][0],h[p][1])}}}},{key:"updateGroupingTime",value:function(t,e,a,r,i){for(var o,s,u=-1e4,l=0;l<a.length|(s=a[l]);l++)i.get(s).startTime+i.get(s).totalDuration>u&&(u=i.get(s).startTime+i.get(s).totalDuration,o=s);if(void 0!==t&&void 0!==o){var c=0;switch(this.reference){case n.default.timingRef.previousStart:c=i.get(t).startTime-i.get(r[0]).startTime+this.delay;break;case n.default.timingRef.previousEnd:c=i.get(o).startTime+i.get(o).totalDuration-i.get(r[0]).startTime+this.delay;break;case n.default.timingRef.absolute:c=this.delay-i.get(r[0]).startTime}for(var f,d=0;d<r.length|(f=r[d]);d++)i.get(f).startTime+=c}}},{key:"groupBy",set:function(t){void 0!==t&&(this._groupBy=t)},get:function(){return this._groupBy}},{key:"reference",set:function(t){if(void 0!==t){console.log("ref is: ",t);var e=n.default.transRef(t);Object.keys(n.default.timingRef).includes(e)?this._reference=t:alert("the 'reference' of TimingSpec has to be one of 'previousStart', 'previousEnd' or 'absolute'. ")}},get:function(){return this._reference}},{key:"delay",set:function(t){void 0!==t&&(t>1e3/n.default.FRAME_RATE?this._delay=t:this._delay=1e3/n.default.FRAME_RATE+1)},get:function(){return this._delay}}])&&u(a.prototype,r),f&&u(a,f),e}();f.orderTypes={ascending:"ascending",descending:"descending",random:"random"};var d=f;e.default=d,t.exports=e.default},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=u(a(3)),n=u(a(8)),i=u(a(0)),o=u(a(2)),s=u(a(1));function u(t){return t&&t.__esModule?t:{default:t}}function l(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.chartSpecs,this.facet,this._animations}var e,a,u;return e=t,u=[{key:"loadSpec",value:function(t,e){var a=new XMLHttpRequest,r="file:"===document.location.protocol?0:200;if(a.open("GET",t,!1),a.overrideMimeType("text/html;charset=utf-8"),a.send(null),a.status===r){var n=a.responseText;e(JSON.parse(n))}else 404===a.status&&console.log("can not find "+t+" ! Please check the url.")}}],(a=[{key:"init",value:function(t){var e=this;this.chartSpecs=[];for(var a=t,i=0;i<a.charts.length;i++){var u=void 0===a.charts[i].name?"chart"+i:a.charts[i].name,c=new r.default(u,a.charts[i].source);this.chartSpecs.push(c)}a.facet&&(this.facet=new n.default(a.facet.type,a.facet.views)),r.default.loadCharts(this.chartSpecs,this.facet);var f=r.default.removeTransAndMerge();document.getElementById("chartContainer").innerHTML="",document.getElementById("chartContainer").appendChild(f);var d=r.default.getBBoxes(),g=r.default.processAnimateChart(document.getElementById("chartContainer").innerHTML,d);if(document.getElementById("videoContainer").innerHTML="",document.getElementById("videoContainer").appendChild(g),this.animations=a.animations,Array.isArray(this.animations))for(var m,h=function(t){var a=e.animations[t],n=document.createElement("div");document.body.appendChild(n),n.innerHTML=r.default.charts[a.chartIdx].outerHTML;for(var i=n.querySelectorAll(a.selection),u=[],c=0;c<r.default.changedAttrs.length;c++)u.push(r.default.changedAttrs[c]);var f=new o.default;f.translate(a,u);var d=[];i.length>0&&[].forEach.call(i,function(t){var e=t.getAttribute("id");if(d.push(e),"path"===t.tagName){var a=s.default.toJSON(t),r=s.default.discretizePath(a);if(r){if("lines"===r.type)for(var n=0;n<r.data.length;n++)a.attr["x"+(1+2*n)]=r.data[n][0][0],a.attr["y"+(1+2*n)]=r.data[n][0][1],a.attr["x"+(2+2*n)]=r.data[n][1][0],a.attr["y"+(2+2*n)]=r.data[n][1][1];else for(var i=Object.keys(r.data),o=0;o<i.length;o++){var u=i[o];"radius"===u?r.data[u].length>1?(a.attr.innerRadius=r.data[u][0].rx+1,a.attr.outterRadius=r.data[u][1].rx-1):(a.attr.innerRadius=0,a.attr.outterRadius=r.data[u][0].rx-1):a.attr[u]=r.data[u]}t=s.default.toDOM(a)}}for(var c={},g=[].concat(l(t.attributes)),m=0;m<g.length;m++){var h=g[m];c[h.name]=t.getAttribute(h.name)}c.bbWidth=t.getBBox().width,c.bbHeight=t.getBBox().height,c.bbX=t.getBBox().x,c.bbY=t.getBBox().y,c.content=t.textContent,c.id=e,c["data-datum"]=JSON.parse(t.getAttribute("data-datum")),"path"!==t.tagName&&"line"!==t.tagName||(c["stroke-dasharray"]=document.getElementById(e).getTotalLength(),c["stroke-dashoffset"]=document.getElementById(e).getTotalLength()),f.domMarks.set(e,c)}),f.calAniTime(d,m),m=f,document.body.removeChild(n)},p=0;p<this.animations.length;p++)h(p);console.log("aniChart specs: ",JSON.stringify(this,null,"\t"))}},{key:"render",value:function(){o.default.renderAnimation()}},{key:"animations",set:function(t){var e=t.map(function(t){return t.chartIdx=0,t}),a=0;if((a=this.facet?this.facet.views[0].length:this.chartSpecs.length)>1)for(var r=function(a){var r=s.default.deepClone(t);r[0].reference=i.default.timingRef.previousEnd;var n=r.map(function(t){return t.chartIdx=a,t});e.push.apply(e,l(n))},n=1;n<a-1;n++)r(n);this._animations=e},get:function(){return this._animations}}])&&c(e.prototype,a),u&&c(e,u),t}();e.default=f,t.exports=e.default},function(t,e,a){"use strict";function r(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=function(){function t(e,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._type,this.views=a,this.type=e}var e,a,n;return e=t,(a=[{key:"type",set:function(e){void 0!==e&&(Object.keys(t.facetType).includes(e)?this._type=e:this._type=t.facetType.row)},get:function(){return this._type}}])&&r(e.prototype,a),n&&r(e,n),t}();n.facetType={row:"row",col:"col"};var i=n;e.default=i,t.exports=e.default},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=o(a(0)),n=o(a(2)),i=o(a(1));function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,a,o;return e=t,o=[{key:"renderFrame",value:function(e){var a=n.default.renderFrame(e);if(void 0===a)return!1;for(var r,o=function(e,a){a[1].forEach(function(e,r){var n="";if("mark"===e.type){if(n="ani"+a[0],document.querySelectorAll("#animask"+a[0]+' [id^="animaskCover"]').length>0){var o=document.querySelector("#animask"+a[0]+' [id^="animaskCover"]');o.parentNode.removeChild(o)}switch(e.attrName){case"textContent":document.getElementById(n).innerHTML=e.value,document.getElementById(n).textContent=e.value;break;case"stroke-dashoffset":document.getElementById(n).setAttributeNS(null,"stroke-dasharray",document.getElementById(n).getTotalLength()),document.getElementById(n).setAttributeNS(null,e.attrName,e.value);break;case"x":case"y":document.getElementById(n).setAttributeNS(null,e.attrName,e.value),document.getElementById("animaskCover"+a[0])&&("y"===e.attrName&&"text"===document.getElementById(a[0]).tagName?document.getElementById("animaskCover"+a[0]).setAttributeNS(null,e.attrName,e.value-parseFloat(document.getElementById("animaskBg"+a[0]).getAttributeNS(null,"height"))):document.getElementById("animaskCover"+a[0]).setAttributeNS(null,e.attrName,e.value)),document.getElementById(n).setAttributeNS(null,e.attrName,e.value);break;default:document.getElementById(n).setAttributeNS(null,e.attrName,e.value)}var s="animaskBg"+a[0],u=document.getElementById(n).getBBox();document.getElementById(s).setAttributeNS(null,"x",u.x-1),document.getElementById(s).setAttributeNS(null,"y",u.y-1),document.getElementById(s).setAttributeNS(null,"width",u.width+2),document.getElementById(s).setAttributeNS(null,"height",u.height+2)}else if("mask"===e.type){n="animask"+a[0];var l=document.querySelectorAll("#"+n+' [id^="animaskCover"]');switch(e.animationType){case"fade":case"move":case"wipe":if(l.length>0){var c=document.getElementById("animaskCover"+a[0]);if("rect"!==c.getAttribute("maskType")){c.parentNode.removeChild(c);var f=t.generateMaskCover(t.coverTypes.rect,a[0],e.attrName,e.value);document.getElementById(n).appendChild(f)}else document.getElementById("animaskCover"+a[0]).setAttributeNS(null,e.attrName,e.value)}else{var d=t.generateMaskCover(t.coverTypes.rect,a[0],e.attrName,e.value);document.getElementById(n).appendChild(d)}break;case"circle":case"wheel":var g=i.default.arc(e.value.cx,e.value.cy,e.value.innerRadius,e.value.outterRadius,e.value.startAngle,e.value.endAngle);if(l.length>0){var m=document.getElementById("animaskCover"+a[0]);if("wedge"!==m.getAttribute("maskType")){m.parentNode.removeChild(m);var h=t.generateMaskCover(t.coverTypes.path,a[0],"d",g);document.getElementById(n).appendChild(h)}else document.getElementById("animaskCover"+a[0]).setAttributeNS(null,"d",g)}else{var p=t.generateMaskCover(t.coverTypes.path,a[0],"d",g);document.getElementById(n).appendChild(p)}break;case"mistake":l.length>0&&document.getElementById("animaskCover"+a[0]).setAttributeNS(null,e.attrName,e.value)}}else console.log("this status has no type")})},s=0;s<a.length|(r=a[s]);s++)o(0,r);return!0}},{key:"generateMaskCover",value:function(e,a,r,n){var i;switch(e){case t.coverTypes.rect:(i=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttributeNS(null,"maskType","rect"),i.setAttributeNS(null,"x",document.getElementById("animaskBg"+a).getAttribute("x")),i.setAttributeNS(null,"y",document.getElementById("animaskBg"+a).getAttribute("y")),i.setAttributeNS(null,"width",document.getElementById("animaskBg"+a).getAttribute("width")),i.setAttributeNS(null,"height",document.getElementById("animaskBg"+a).getAttribute("height"));break;case t.coverTypes.path:(i=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttributeNS(null,"maskType","wedge"),document.getElementById(a).getAttribute("transform")&&i.setAttributeNS(null,"tranform",document.getElementById(a).getAttribute("transform"))}return i.setAttributeNS(null,"id","animaskCover"+a),i.setAttributeNS(null,"fill","#000"),i.setAttributeNS(null,"stroke","#000"),i.setAttributeNS(null,"stroke-width",2),"stroke"!==r&&i.setAttributeNS(null,r,n),i}},{key:"resetCover",value:function(){var t=document.querySelectorAll('[id^="animaskCover"]');t.length>0&&[].forEach.call(t,function(t){t.parentNode.removeChild(t)})}},{key:"play",value:function(){var t=this,e=0,a=setInterval(function(){e=parseInt(e/(1e3/r.default.FRAME_RATE))*(1e3/r.default.FRAME_RATE);var i=t.renderFrame(e);((e+=1e3/r.default.FRAME_RATE)>n.default.wholeEndTime||!i)&&(clearInterval(a),a="undefined",e=0)},1e3/r.default.FRAME_RATE)}}],(a=null)&&s(e.prototype,a),o&&s(e,o),t}();u.coverTypes={rect:Symbol(),path:Symbol()};var l=u;e.default=l,t.exports=e.default}])});
//# sourceMappingURL=anichart.min.js.map